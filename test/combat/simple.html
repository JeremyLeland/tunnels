<title>Simple battle</title>
<link rel="stylesheet" href="../../style.css">

<script type="module">
  import { Game } from '../../src/Game.js';
  import { Actor } from '../../src/Actor.js';
  import { AvoidingActor } from '../../src/AvoidingActor.js';
  import { Gun } from '../../src/Gun.js';
  import { Bullet } from '../../src/Bullet.js';
  import { World } from '../../src/World.js';
  import { Line } from '../../src/Line.js';

  import { ActorInfo } from '../../info/info.js';
  

  class Marine extends Actor {
    gun = new Gun( ActorInfo.marine.gun, this );

    constructor( values ) {
      super( values, ActorInfo.marine );
    }

    update( dt ) {
      this.gun.update( dt );
      super.update( dt );
    }

    shoot( bullet ) {
      world.addBullet( bullet );
    }

    draw( ctx ) {
      super.draw( ctx );

      this.#drawBar( ctx, 'red', 1, -14, -34, 28 );
      this.#drawBar( ctx, 'yellow', this.gun.getUIPercentage(), -14, -28, 28 );
    }

    #drawBar( ctx, color, val, offsetX, offsetY, width ) {
      const bar = new Path2D();
      bar.rect(
        this.x + offsetX, this.y + offsetY, 
        width * val, 4
      );

      ctx.fillStyle = color;
      ctx.fill( bar );
      ctx.stroke( bar );
    }
  }

  class Alien extends AvoidingActor {
    
    constructor( values ) {
      super( values, ActorInfo.alien );
    }

    update( dt ) {
      this.avoidList = world.lines.concat( world.actors.filter( a => a instanceof Alien ) );

      super.update( dt );
    }
  }

  const game = new Game();
  const world = new World();

  const player = new Marine( { x: 300, y: 300 } );
  world.actors.push( player );

  for ( let i = 0; i < 5; i ++ ) {
    const alien = new Alien( { x: i * 50, y: 50 } );
    alien.target = player;
    world.actors.push( alien );
  }

  world.lines.push( new Line( 200, 100, 300, 100 ) );
  world.lines.push( new Line( 300, 100, 300, 200 ) );
  world.lines.push( new Line( 300, 200, 200, 200 ) );
  world.lines.push( new Line( 200, 200, 200, 100 ) );

  world.lines.push( new Line( 500, 200, 600, 200 ) );
  world.lines.push( new Line( 600, 200, 550, 300 ) );
  world.lines.push( new Line( 550, 300, 500, 200 ) );

  game.update = ( dt ) => {
    //player.target = { x: game.mouse.x, y: game.mouse.y };
    player.goalAngle = Math.atan2( game.mouse.y - player.y, game.mouse.x - player.x );
    player.gun.isShooting = game.mouse.down;

    world.update( dt );
  };

  game.draw = ( ctx ) => {
    world.draw( ctx );
  };

  

</script>