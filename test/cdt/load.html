<title>Loading CDT with Poly2Tri.js</title>
<link rel="stylesheet" href="../../style.css">

<canvas id="canvas" width="1000px" height="1000px"></canvas>

<script type="module">
  import '../../lib/poly2tri.js';

  const json = JSON.parse( await ( await fetch( '../../levels/squadMove.json' ) ).text() );

  var contour = json.walls[ 0 ].map( point => 
    new poly2tri.Point( point[ 0 ], point[ 1 ] )
  );
  var swctx = new poly2tri.SweepContext(contour);

  for ( let i = 1; i < json.walls.length; i ++ ) { 
    var hole = json.walls[ i ].map( point =>
      new poly2tri.Point( point[ 0 ], point[ 1 ] )
    );
    swctx.addHole(hole);
  }

  swctx.triangulate();
  var triangles = swctx.getTriangles();

  const ctx = document.getElementById( 'canvas' ).getContext( '2d' );

  ctx.strokeStyle = 'yellow';
  ctx.fillStyle = '#ff03';

  triangles.forEach(t => {
    ctx.beginPath();
    t.getPoints().forEach( p => {
        ctx.lineTo( p.x, p.y );
    });
    ctx.closePath();
    ctx.fill();
    ctx.stroke();
    // or t.getPoint(0), t.getPoint(1), t.getPoint(2)
  });
</script>